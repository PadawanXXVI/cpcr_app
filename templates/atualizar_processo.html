<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Atualizar Processo - Central de Relacionamento</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
  <main class="card">
    <h1>Atualizar Processo</h1>

    <!-- Informações do processo -->
    <p><strong>Nº Processo:</strong> <span class="numero-processo">{{ processo.numero_processo }}</span></p>
    <p><strong>RA de Origem:</strong> {{ processo.admin_regional }}</p>
    <p><strong>Diretoria de Destino:</strong> {{ processo.diretoria_destino }}</p>
    <p><strong>Demanda:</strong> {{ processo.tipo_demanda }}</p>
    <p><strong>Status Atual:</strong> {{ processo.status_demanda }}</p>

    <!-- Formulário de atualização -->
    <form method="POST">
      <input type="hidden" name="id_processo" value="{{ processo.id_processo }}">

      <label for="status_demanda">Novo Status:</label>
      <select id="status_demanda" name="status_demanda" required>
        <option value="">Selecione</option>
        {% for s in lista_status %}
          <option value="{{ s }}" {% if processo.status_demanda == s %}selected{% endif %}>{{ s }}</option>
        {% endfor %}
      </select>

      <label for="observacoes">Observações:</label>
      <textarea id="observacoes" name="observacoes" placeholder="Motivo da alteração, complementos ou despachos"></textarea>

      <label for="data_movimentacao">Data da Movimentação (opcional):</label>
      <input type="date" id="data_movimentacao" name="data_movimentacao" />

      <label for="responsavel_movimentacao">Responsável pela Movimentação (opcional):</label>
      <input type="text" id="responsavel_movimentacao" name="responsavel_movimentacao" placeholder="Nome completo do responsável" />

      <div class="botoes">
        <button class="btn-primary" type="submit">Salvar Alterações</button>
        <a href="{{ url_for('dashboard') }}" class="btn-secondary">← Voltar ao Painel</a>
      </div>
    </form>

    <!-- Histórico -->
    <div class="painel-totais mt-2">
      <h2>Histórico de Movimentações</h2>
      {% if historico %}
        <ul>
          {% for mov in historico %}
          <li>
            <strong>{{ mov.data_movimentacao.strftime('%d/%m/%Y') }}</strong> — 
            {{ mov.status_movimentado }} por <em>{{ mov.responsavel }}</em><br>
            {% if mov.observacoes %}<small>"{{ mov.observacoes }}"</small>{% endif %}
          </li>
          {% endfor %}
        </ul>
      {% else %}
        <p>Nenhuma movimentação registrada ainda.</p>
      {% endif %}
    </div>

    <div class="mt-2">
      <a href="{{ url_for('logout') }}" class="btn-terciario">Sair do Sistema</a>
    </div>
  </main>
</body>
</html>
