<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Atualização de Processo - CPCR</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
  <div class="card">
    <h1>Atualizar Processo</h1>
    <p>Atualize as informações de status, diretoria ou registre observações</p>

    <!-- Dados fixos do processo -->
    <div class="form-group">
      <strong>Número do processo:</strong> {{ processo.numero_processo }}
    </div>
    <div class="form-group">
      <strong>Data de criação na RA:</strong> {{ processo.data_criacao_ra }}
    </div>
    <div class="form-group">
      <strong>Data de entrada na CPCR:</strong> {{ processo.data_entrada_cpcr }}
    </div>
    <div class="form-group">
      <strong>Região Administrativa:</strong> {{ processo.admin_regional }}
    </div>
    <div class="form-group">
      <strong>Demanda:</strong> {{ processo.tipo_demanda }}
    </div>

    <!-- Formulário de atualização -->
    <form method="POST">
      <div class="form-group">
        <label for="status_demanda">Novo Status</label>
        <select id="status_demanda" name="status_demanda" required>
          <option value="">Selecione</option>
          {% for status in lista_status %}
            <option value="{{ status }}" {% if status == processo.status_demanda %}selected{% endif %}>{{ status }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="form-group">
        <label for="diretoria_destino">Diretoria de Destino</label>
        <select id="diretoria_destino" name="diretoria_destino">
          <option value="">Selecione</option>
          {% for dir in lista_diretorias %}
            <option value="{{ dir }}" {% if dir == processo.diretoria_destino %}selected{% endif %}>{{ dir }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="form-group">
        <label for="observacoes">Observações</label>
        <textarea id="observacoes" name="observacoes" rows="3" placeholder="Descreva o motivo da alteração, se necessário..."></textarea>
      </div>

      <div class="botoes">
        <button type="submit" class="btn-primary">Salvar Alterações</button>
        <a href="{{ url_for('cadastro_processo') }}" class="btn-secondary">← Voltar</a>
      </div>
    </form>

    <hr style="margin: 2rem 0;">

    <!-- Histórico -->
    <h2>Histórico de Movimentações</h2>
    {% if historico %}
      <ul style="text-align: left;">
        {% for mov in historico %}
          <li>
            <strong>{{ mov.data_movimentacao }}:</strong>
            {{ mov.status_movimentado }} —
            <em>{{ mov.responsavel }}</em>
            {% if mov.observacoes %}<br><small>{{ mov.observacoes }}</small>{% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>Nenhuma movimentação registrada até o momento.</p>
    {% endif %}

  </div>
</body>
</html>
